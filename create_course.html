<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Create Course</title>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script src="scripts/jquery.min.js" onload="window.$ = window.jQuery = module.exports;"></script>
	</head>
	<body>
		<div class="buffer">
		</div>
		<div class="nav">
			<ul>
				<li>
					<a href="courses.html">Courses</a>
				</li>
				<li>
					<a href="degree-plans.html">Degree Plans</a>
				</li>
				<li>
					<a href="prediction.html">Prediction</a>
				</li>
			</ul>
		</div>
		<div>
			<div style="padding-bottom:5px">
				<label>Course Title</label>
				<br>
				<input id="name" type="text" placeholder="Intro to Comp Sci" style="width:50%"></input>
			</div>
			<br>
			<div>
				<div style="float:left">
					<label>Major</label>
					<br>
					<input id="major" type="text" placeholder="CS" style="width:50%"></input>
				</div>
			<div style="float:left">
				<label>Identifier</label>
				<br>
				<input id="ident" type="text" placeholder="1122" style="width:50%"></input> 
			</div>
		</div>
		<div class="buffer">
		</div>
		<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for prereq.." style="float:left; width:40%; margin-bottom:10px">
		<br>
		<div style="clear:left">
			<label style="padding-right:calc(40% - 6em)">Unselected Prereqs</label><label>Prereqs</label>
			<br>
			<ul id="unselected" class="myUL" style="float:left">
			</ul>
		</div>
		<ul id="prereqs" class="myUL" style="float:left">
		</ul>
		</div>
	<div style="clear:left">
		<button id="save">Save</button>
		<a href="courses.html"><button>Cancel</button></a>
	</div>
	<script>
	// You can also require other files to run in this process
	require('./renderer.js');

	var storage = require("./storage");
	var prereqArray = [];
	$( document ).ready(function() {
		storage.readData("data.json", function(obj){
		prereqs = $("#prereqs");
		unselected = $("#unselected");
		class_list = obj.class_list;
		for(key in class_list)
		{
			c = class_list[key];
			html = '<li><strong>' + c.name + '</strong>' + c.ident + '</li>';
			s_item = $(html);
			u_item = $(html);
			s_item.data("other", u_item);
			u_item.data("other", s_item);
			s_item.data('ident', c.ident);
			s_item.click(function(){
			$(this).hide();
			u_item = $(this).data("other");
			u_item.show();

			ident = $(this).data('ident');
			for(var i = 0; i < prereqArray.length; i++)
			{
				s = prereqArray[i];
				if(s.toLowerCase() == ident.toLowerCase())
				{
				prereqArray.splice(i, 1);
				break;

				}

			}

			});

			u_item.data('ident', c.ident);
			u_item.click(function() {
			$(this).hide();
			s_item = $(this).data("other");
			s_item.show();

			ident = $(this).data('ident');
			prereqArray.push(ident);
			});

			s_item.hide();

			prereqs.append(s_item);
			unselected.append(u_item);

		}

		});


		$("#save").click(function(){
		name = $("#name").val();
		ident = $("#ident").val();

		if(name != "" && ident != "") // validate
		{
			storage.readData("data.json", function(obj){
			storage.updateClass(obj, name, name, ident, prereqArray);
			storage.saveData("data.json", obj, function(){
				window.location.href = 'courses.html';
			});
			});

		}
		});
	});

		
		function myFunction() {
	// Declare variables
	var input, filter, ul, li, a, i;
	input = document.getElementsByClassName('myInput');
	filter = input.value.toUpperCase();
	ul = document.getElementsByClassName("myUL");
	li = ul.getElementsByTagName('li');

	// Loop through all list items, and hide those who don't match the search query
	for (i = 0; i < li.length; i++) {
		a = li[i].getElementsByTagName("a")[0];
		if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
			li[i].style.display = "";
		} else {
			li[i].style.display = "none";
		}
	}
}
		
		
	</script>
	</body>
</html>
