<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Edit Course</title>
    <script src="scripts/jquery.min.js" onload="window.$ = window.jQuery = module.exports;"></script>
  </head>
  <body>
    <a href="courses.html">Back to Courses</a>
    <h1>Edit Courses</h1>

    <div>
      <p> Course Title: </p>
      <input id="name" type="text" placeholder="Intro to Comp Sci"></input> <br>
      <p> Course Identifier: </p>
      <input id="ident" type="text" placeholder="CS 1122"></input> <br>

      <p> Prereqs </p>
      <ul id="prereqs">
      </ul>

      <p> Unselected Prereqs </p>
      <ul id="unselected">
      </ul>
    </div>

    <div>
      <button id="save">Save</button>
      <a href="courses.html"><button>Cancel</button></a>
      <button id="delete">Delete</button>
    </div>

    <script>
      // You can also require other files to run in this process
      require('./renderer.js');
      var storage = require("./storage");
      var prereqArray = [];
      $( document ).ready(function() {
        selected = require('electron').remote.getGlobal('params').name;
        console.log('selected: ' + selected);
        if(selected != '')
        {
          storage.readData("data.json", function(obj){
            course = storage.getClass(obj, selected);
            $("#name").val(course.name);
            $("#ident").val(course.ident);

            prereqs = $("#prereqs");
            unselected = $("#unselected");
            class_list = obj.class_list;
            for(key in class_list)
            {
              c = class_list[key];
              if(c.ident != selected)
              {
                html = '<li><strong>' + c.name + '</strong>  ' + c.ident + '</li>';
                s_item = $(html);
                u_item = $(html);
                s_item.data("other", u_item);
                u_item.data("other", s_item);
                s_item.data('ident', c.ident);
                s_item.click(function(){
                  $(this).hide();
                  u_item = $(this).data("other");
                  u_item.show();

                  ident = $(this).data('ident');
                  for(var i = 0; i < prereqArray.length; i++)
                  {
                    s = prereqArray[i];
                    if(s.toLowerCase() == ident.toLowerCase())
                    {
                      prereqArray.splice(i, 1);
                      break;

                    }

                  }

                });

                u_item.data('ident', c.ident);
                u_item.click(function() {
                  $(this).hide();
                  s_item = $(this).data("other");
                  s_item.show();

                  ident = $(this).data('ident');
                  prereqArray.push(ident);
                });

                class_prereq = course.prereq;
                found = false;
                for(key2 in class_prereq) {
                  ident = class_prereq[key2];
                  if(ident == c.ident)
                  {
                    found = true;
                    u_item.hide();
                    break;

                  }

                }
                if(!found)
                {
                  s_item.hide();
                }

                prereqs.append(s_item);
                unselected.append(u_item);
              }

            }

          });

        }

        $("#save").click(function(){
          name = $("#name").val();
          ident = $("#ident").val();

          if(name != "" && ident != "") // validate
          {
            storage.readData("data.json", function(obj){
              storage.updateClass(obj, selected, name, ident, prereqArray);
              storage.saveData("data.json", obj, function(){
                window.location.href = 'courses.html';
              });
            });

          }
        });

        $("#delete").click(function() {
          storage.readData("data.json", function(obj){
            storage.removeClass(obj, selected);
            storage.saveData("data.json", obj, function(){
              window.location.href = 'courses.html';
            });
          });
        });
      });

    </script>
  </body>
</html>
