<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Prediction</title>
    <script src="scripts/jquery.min.js" onload="window.$ = window.jQuery = module.exports;"></script>
    <script src="prediction-algorithm.js"></script>
  </head>
  <body>
    <a href="prediction_list.html">Back to Plans</a>
    <h1>Prediction</h1>

    <div>
      <p id="name"></p>

      <p> Semester 1 </p>
      <ul id="semester-1">
      </ul>

      <p> Semester 2 </p>
      <ul id="semester-2">
      </ul>

      <p> Semester 3 </p>
      <ul id="semester-3">
      </ul>

      <p> Semester 4 </p>
      <ul id="semester-4">
      </ul>

      <p> Semester 5 </p>
      <ul id="semester-5">
      </ul>

      <p> Semester 6 </p>
      <ul id="semester-6">
      </ul>

      <p> Semester 7 </p>
      <ul id="semester-7">
      </ul>

      <p> Semester 8 </p>
      <ul id="semester-8">
      </ul>
    </div>

    <div>
      <button id="predict">Predict</button>
    </div>

    <script>
      require('./renderer.js');
      var storage = require("./storage");

      selected = "";
      semesters = {};

      course_list = null;
      $(document).ready(function() {
        for(var i = 1; i < 10; i++)
        {
          semesters["semester-" + i] = [];

        }

        selected = require('electron').remote.getGlobal('params').name;

        storage.readData("data.json", function(obj){
          course_list = obj.class_list;

          plan = storage.getPlan(obj, selected);
          $("#name").html(plan.name);
          semesters = plan.semesters;
          for(semester_key in semesters)
          {
            semester_obj = semesters[semester_key];
            semester_ul = $("#" + semester_key);
            for(ident_key in semester_obj)
            {
              ident = semester_obj[ident_key];
              name = storage.getClass(obj, ident).name;
              item = $('<li>' + name + " - " + ident + '</li><input class="count" type="text" value="0"></input>');
              item.data("ident", ident);
              item.data("semester", semester_key);
              semester_ul.append(item);
            }
          }
        });

        $("#predict").click(function() {
          // Step One of Prediction
          storage.readData("data.json", function(obj) {
            // leads to Step Two of Prediction
            finish(obj.class_list, obj.plan_list);
          });
        });
      });
      
      function finish(class_list, plan_list) {
        // Step Two of Prediction
        
        var course_ids = [];
        for(var key in class_list) course_ids.push(class_list[key].ident);
        console.log(JSON.stringify(course_ids));
        
        // NOTE: This is hardcoded to get a standard 8 semesters from the degree
        // plan. The code in prediction-algorithm .js (at present) is flexible
        // enough to automatically handle more or fewer semesters. That may be
        // useful for grad programs or some such.
        var degree_plans = [];
        for(var key in plan_list) {
          var p = plan_list[key];
          var dp = { degree_plan_id : p.name , semesters : [] };
          for(var i=1; i<=8; i++) {
            dp.semesters.push(p.semesters["semester-"+i].slice());
          }
        }
        console.log(JSON.stringify(dp));
        
        // TODO: Get enrollments from form above.
        
        var enrollments = [];
        
        
        
        
        
        
        console.log("before prediction");
        var prediction_algorithm = require( './prediction-algorithm.js' );
        var predict = prediction_algorithm.predict;
        var result = predict( course_ids, degree_plans, enrollments );
        console.log("after prediction");
        
        // print result data
        for(var iteration=0 ; iteration < result.length; iteration++) {
            console.log("\nITERATION " + iteration + "\n");
            for(var id in result[iteration]) {
                console.log("id: "+id + ", sum: "+result[iteration][id]);
            }
        }
      }
    </script>
  </body>
</html>
